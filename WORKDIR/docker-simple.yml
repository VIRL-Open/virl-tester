#
# ping test
# lxc-1 is at 10.0.0.6
# docker-1 is at 10.0.0.13
# docker-2 is at 10.0.0.9
# iosv-1 connects them all
#
#
#             .---------.             
#            /           \            
#           (    Flat1    )           
#            `.         ,'            
#              `-------'              
#                  |                  
#                  |                  
#                  |                  
# +----+     iosv-1|           +-----+
# |    |           -.          |     |
# | D2 |<------- (   )-------->|  D1 |
# |    |          `-'          |     |
# +----+           |           +-----+
#                  |                  
#                  |                  
#               +--+--+               
#               |     |               
#               | LXC 1               
#               |     |               
#               +-----+               
#
#
# test is curl from lxc to d1 and d2
# docker images that have to be installed are
# - httpd (docker pull httpd, https://hub.docker.com/_/httpd/)
# - nginx (docker pull nginx, https://hub.docker.com/_/nginx/)
# names of the containers are then
# - docker-httpd
# - docker-nginx
# those are the names in the .virl file
#
# 
# ralph
#

config:
  # the VIRL host
  host: 172.23.175.249
  # username and password
  user: guest
  password: guest
  # loglevel (0-4, 4=Debug)
  loglevel: 2
  # default wait time (spinup / actions)
  wait: 300
  #parallel: 1


sims:
- topo: Topos/docker-test.virl
  nodes:
  - lxc-1:
    - type: command
      sleep: 20
      transport: ssh
      in:
      - 'r=$(curl -s http://10.0.0.9:80/ | wc -l); test $r -gt 0 && echo "SUCCESS"'
      out:
      - ^SUCCESS$
  - lxc-1:
    - type: command
      transport: ssh
      in:
      - 'r=$(curl -s http://10.0.0.13:80/ | wc -l); test $r -gt 0 && echo "SUCCESS"'
      out:
      - ^SUCCESS$
  - iosv-1:
    - type: command
      transport: telnet
      in:
      - ping 172.16.1.254
      - ping 172.16.1.254
      out:
      - Success rate is 100 percent
